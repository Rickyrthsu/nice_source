name: 新增收藏 (Add Collection)

# 這是關鍵：允許我們手動觸發
on:
  workflow_dispatch:
    inputs:
      # 這就是你說的下拉選單
      collection_type:
        description: '請選擇類別'
        required: true
        type: choice
        options:
          - 漫畫
          - 影片
          - 動漫
      # 這就是你說的輸入框
      collection_value:
        description: '請輸入 番號 (漫畫/影片) 或 網址 (動漫)'
        required: true
        type: string

jobs:
  scrape-and-commit:
    runs-on: ubuntu-latest # 使用最新的 ubuntu 伺服器
    
    steps:
      # 步驟 1: 取得你倉庫的程式碼
      - name: Checkout repository
        uses: actions/checkout@v3

      # 步驟 2: 設定 Python 環境
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # 指定 python 版本

      # 步驟 3: 安裝爬蟲需要的套件
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # 安裝 requests (用於 http) 和 beautifulsoup4 (用於爬動漫)
          pip install requests beautifulsoup4
          
      # 步驟 4: 執行你的 Python 爬蟲腳本
      - name: Run scraper
        # 這裡把表單的輸入值，傳給 Python 腳本
        env:
          COLLECTION_TYPE: ${{ github.event.inputs.collection_type }}
          COLLECTION_VALUE: ${{ github.event.inputs.collection_value }}
        run: |
          python scripts/scrape.py
          
      # 步驟 5: 自動把 data.json 存回倉庫
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "chore(data): 自動更新收藏"
          file_pattern: data.json # 只 commit data.json 的變動